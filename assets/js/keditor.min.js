/**!
 * KEditor - Kademi content editor
 * @copyright: Kademi (http://kademi.co)
 * @author: Kademi (http://kademi.co)
 * @version: 1.1.7
 * @dependencies: $, $.fn.draggable, $.fn.droppable, $.fn.sortable, Bootstrap (optional), FontAwesome (optional)
 */
!function(t){var e=function(){if("undefined"!=typeof console&&o.debug===!0){var t=Array.prototype.slice.apply(arguments);t.unshift("[KEditor]"),console.log.apply(console,t)}},n=function(t){throw new Error("[KEditor] "+t)};t.fn.draggable||n("$.fn.draggable does not exist. Please import $.fn.draggable into your document for continue using KEditor."),t.fn.droppable||n("$.fn.droppable does not exist. Please import $.fn.droppable into your document for continue using KEditor."),t.fn.sortable||n("$.fn.sortable does not exist. Please import $.fn.sortable into your document for continue using KEditor.");var o=function(e,n){this.element=e,this.options=t.extend({},o.DEFAULTS,n),this.init(e)};o.instances={},o.debug=!0,o.version="1.1.7",o.DEFAULTS={niceScrollEnabled:!0,nestedContainerEnabled:!0,btnMoveContainerText:'<i class="fa fa-sort"></i>',btnMoveComponentText:'<i class="fa fa-arrows"></i>',btnSettingContainerText:'<i class="fa fa-cog"></i>',btnSettingComponentText:'<i class="fa fa-cog"></i>',btnDuplicateContainerText:'<i class="fa fa-files-o"></i>',btnDuplicateComponentText:'<i class="fa fa-files-o"></i>',btnDeleteContainerText:'<i class="fa fa-times"></i>',btnDeleteComponentText:'<i class="fa fa-times"></i>',tabContainersText:"Containers",tabContainersTitle:"Containers",tabComponentsText:"Components",tabComponentsTitle:"Components",confirmDeleteContainerText:"Are you sure that you want to delete this container? This action can not be undone!",confirmDeleteComponentText:"Are you sure that you want to delete this component? This action can not be undone!",tabTooltipEnabled:!0,extraTabs:null,defaultComponentType:"blank",sidebarContainer:null,snippetsUrl:"snippets/snippets.html",snippetsTooltipEnabled:!0,snippetsTooltipPosition:"left",snippetsFilterEnabled:!0,snippetsCategoriesSeparator:";",iframeMode:!1,contentStyles:[],contentAreasSelector:null,contentAreasWrapper:'<div class="keditor-ui keditor-content-areas-wrapper"></div>',containerSettingEnabled:!1,containerSettingInitFunction:null,containerSettingShowFunction:null,containerSettingHideFunction:null,onReady:function(){},onInitFrame:function(t,e,n){},onSidebarToggled:function(t){},onContentChanged:function(t,e){},onBeforeInitContentArea:function(t){},onInitContentArea:function(t){},onBeforeInitContainer:function(t,e){},onInitContainer:function(t,e){},onBeforeContainerDeleted:function(t,e,n){},onContainerDeleted:function(t,e,n){},onContainerChanged:function(t,e,n){},onContainerDuplicated:function(t,e,n,o){},onContainerSelected:function(t,e,n){},onContainerSnippetDropped:function(t,e,n,o){},onComponentReady:function(t){},onBeforeInitComponent:function(t,e){},onInitComponent:function(t,e){},onBeforeComponentDeleted:function(t,e,n){},onComponentDeleted:function(t,e,n){},onComponentChanged:function(t,e,n){},onComponentDuplicated:function(t,e,n,o){},onComponentSelected:function(t,e,n){},onComponentSnippetDropped:function(t,e,n,o){},onBeforeDynamicContentLoad:function(t,e,n){},onDynamicContentLoaded:function(t,e,n,o,i){},onDynamicContentError:function(t,e,n,o,i){}},o.components={blank:{settingEnabled:!1}},o.log=e,o.error=n,o.prototype.init=function(n){var o=this,i=o.options;if(i.iframeMode)n=o.initFrame(n);else if(o.window=window,o.body=t(document.body),n.is("textarea")){e("Target is textarea",n);var a=n.val(),r=t(i.contentAreasWrapper||"<div />");n.after(r),r.attr({"class":"keditor-ui keditor-wrapper"});var s=r.attr("id");s||(s=o.generateId("wrapper"),r.attr("id",s)),r.html(a),n.addClass("keditor-hidden-element"),n.attr("data-keditor-wrapper","#"+s),n=r}var d,c=o.body;if(c.hasClass("initialized-snippets-list")){e("Snippets list is already initialized!");var l=c.find("#keditor-snippets-list");o.containerSnippets=l.find(".keditor-snippet[data-type=container]"),o.componentSnippets=l.find(".keditor-snippet[data-type^=component]")}else d=o.initSidebar(),c.addClass("initialized-snippets-list");c.hasClass("initialized-click-event-handlers")?e("CLick event handlers is already initialized!"):(o.initKEditorClicks(),c.addClass("initialized-click-event-handlers")),o.initContentAreas(n),d||"function"!=typeof i.onReady||i.onReady.call(o)},o.prototype.generateId=function(t){var e=(new Date).getTime(),n=Math.round(9876543210*Math.random());return"keditor-"+t+"-"+e+n},o.prototype.initNiceScroll=function(n){e("initNiceScroll",n),t.fn.niceScroll&&this.options.niceScrollEnabled?(e("Initialize $.fn.niceScroll"),n.niceScroll({cursorcolor:"#999",cursorwidth:6,railpadding:{top:0,right:0,left:0,bottom:0},cursorborder:"",disablemutationobserver:!0})):e("$.fn.niceScroll does not exist. Use default sidebar.")},o.prototype.initFrame=function(n){e("initFrame",n);var o=this,i=o.options,a=n.is("textarea")?n.val():n.html(),r=t("<iframe />"),s=o.generateId("frame");n.after(r),r.attr({id:s,"class":"keditor-ui keditor-frame"}),n.addClass("keditor-hidden-element"),n.attr("data-keditor-frame","#"+s);var d=o.iframeDoc=r.contents();d.get(0).open(),d.get(0).close(),o.window=r[0].contentWindow?r[0].contentWindow:r[0].contentDocument.defaultView;var c=o.iframeHead=d.find("head"),l=o.iframeBody=d.find("body");e("Adding styles to iframe...");var p="";t('[data-type="keditor-style"]').each(function(){var e=t(this),n=e.attr("href")||e.attr("data-href")||"";p+=n?'<link rel="stylesheet" type="text/css" href="'+n+'" />\n':'<style type="text/css">'+e.html()+"</style>\n"}),i.contentStyles&&t.isArray(i.contentStyles)&&t.each(i.contentStyles,function(t,e){var n="";e.id&&(n=' id="'+e.id+'" '),p+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'"'+n+" />\n":'<style type="text/css"'+n+">"+e.content+"</style>\n"}),e("Styles: \n"+p),c.append(p),e("All styles are added"),e("Adding original content to iframe..."),i.contentAreasWrapper||(i.contentAreasWrapper='<div class="keditor-ui keditor-content-areas-wrapper"></div>');var f=o.contentAreasWrapper=t(i.contentAreasWrapper);return f.html(a),l.append(f),o.body=l,"function"==typeof i.onInitFrame&&i.onInitFrame.call(o,r,c,l),f},o.prototype.initSidebar=function(){e("initSidebar");var o=this,i=o.options,a=o.body;a.addClass("opened-keditor-sidebar");var r=a;return i.sidebarContainer&&(r=a.find(i.sidebarContainer)),e("Render Keditor sidebar"),r.append('<div id="keditor-sidebar" class="keditor-ui">   <a id="keditor-sidebar-toggler" class="keditor-ui"><i class="fa fa-chevron-right"></i></a>   <div id="keditor-snippets-list" class="keditor-ui"></div>   <div id="keditor-snippets-content" class="keditor-ui" style="display: none"></div>   <div id="keditor-setting-panel" class="keditor-ui">       <div id="keditor-setting-header" class="keditor-ui">           <span id="keditor-setting-title" class="keditor-ui"></span>           <a href="#" id="keditor-setting-closer" class="keditor-ui"><i class="fa fa-arrow-right"></i></a>       </div>       <div id="keditor-setting-body" class="keditor-ui">           <div id="keditor-setting-forms" class="keditor-ui"></div>       </div>   </div></div>'),o.initSidebarToggler(),"string"==typeof i.snippetsUrl&&i.snippetsUrl.length>0?(e('Getting snippets form "'+i.snippetsUrl+'"...'),t.ajax({type:"get",dataType:"html",url:i.snippetsUrl,success:function(t){e("Success in getting snippets"),o.renderSnippets(t),o.initSnippets(),o.initTabs(),o.initTabsSwitcher(),o.initSettingPanel(),i.snippetsFilterEnabled&&(o.initSnippetsFilter("Container"),o.initSnippetsFilter("Component")),(i.snippetsTooltipEnabled||i.tabTooltipEnabled)&&(e("Initialize Bootstrap tooltip plugin"),a.find("#keditor-snippets-list").find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})),"function"==typeof i.onReady&&i.onReady.call(o)},error:function(t){e("Error when getting snippets",t)}})):void n('"snippetsUrl" must be not null!')},o.prototype.initSnippetsFilter=function(n){e("initSnippetsFilter for "+n);var o=this,i=o.options,a=o.body,r=n.toLowerCase(),s=o["snippets"+n+"Categories"],d="";d+='<div id="keditor-'+r+'-snippets-filter-wrapper" class="keditor-ui keditor-snippets-filter-wrapper">',d+='     <input type="text" id="keditor-'+r+'-snippets-search" class="keditor-ui keditor-snippets-search" value="" placeholder="Type to search..." />',d+='     <select id="keditor-'+r+'-snippets-filter" class="keditor-ui keditor-snippets-filter">',d+='         <option value="" selected="selected">All</option>';for(var c=0;c<s.length;c++)d+='     <option value="'+s[c]+'">'+s[c]+"</option>";d+="     </select>",d+="</div>";var l=a.find("#keditor-"+r+"-snippets-tab"),p=l.find(".keditor-snippet");l.prepend(d),p.each(function(){var e=t(this),n=e.attr("data-keditor-categories")||"",o=n.toLowerCase();n=n.split(i.snippetsCategoriesSeparator),o=o.split(i.snippetsCategoriesSeparator),e.data("categories",n),e.data("categoriesFilter",o)});var f=l.find(".keditor-snippets-search"),C=l.find(".keditor-snippets-filter"),u=function(){var n=(C.val()||"").toLowerCase(),o=(f.val()||"").toLowerCase();e('Do filter with selected category is "'+n+'" and search text is "'+o+'"'),n||o?(e("Filtering snippets"),p.each(function(){var e=t(this),i=e.data("categoriesFilter"),a=i.join(";"),r=0;if(n&&t.inArray(n,i)===-1&&r++,o){var s=e.attr("title").toLowerCase();s.indexOf(o)===-1&&a.indexOf(o)===-1&&r++}e[0===r?"removeClass":"addClass"]("not-matched")})):(e("Show all snippets"),p.removeClass("not-matched"))};C.on("change",function(){u()});var g;f.on("keydown",function(){clearTimeout(g),g=setTimeout(function(){u()},200)})},o.prototype.toggleSidebar=function(t){e("toggleSidebar",t);var n=this,o=n.options,i=n.body,a=i.find("#keditor-sidebar-toggler i");t?(i.addClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-right")):(i.removeClass("opened-keditor-sidebar"),a.attr("class","fa fa-chevron-left")),"function"==typeof o.onSidebarToggled&&o.onSidebarToggled.call(n,t)},o.prototype.initSidebarToggler=function(){e("initSidebarToggler");var t=this,n=t.body;n.find("#keditor-sidebar-toggler").on("click",function(e){e.preventDefault(),t.toggleSidebar(!n.hasClass("opened-keditor-sidebar"))})},o.prototype.renderSnippets=function(n){e("renderSnippets");var o=this,i=o.options,a=o.body,r="",s="",d="";o.snippetsContainerCategories=[],o.snippetsComponentCategories=[],t("<div />").html(n).find("> div").each(function(e){var n=t(this),a=n.html().trim(),c=n.attr("data-preview"),l=n.attr("data-type"),p=n.attr("data-keditor-title"),f="",C=n.attr("data-keditor-categories")||"";f+='<section class="keditor-ui keditor-snippet" data-snippet="#keditor-snippet-'+e+'" data-type="'+l+'" '+(i.snippetsTooltipEnabled?'data-toggle="tooltip" data-placement="'+i.snippetsTooltipPosition+'"':"")+' title="'+p+'" data-keditor-categories="'+C+'">',f+='   <img class="keditor-ui keditor-snippet-preview" src="'+c+'" />',f+="</section>",C=C.split(i.snippetsCategoriesSeparator),"container"===l?(r+=f,o.snippetsContainerCategories=o.snippetsContainerCategories.concat(C)):l.indexOf("component")!==-1&&(s+=f,o.snippetsComponentCategories=o.snippetsComponentCategories.concat(C));var u=o.getDataAttributes(n,["data-preview","data-type","data-keditor-title","data-keditor-categories"],!0);d+='<script id="keditor-snippet-'+e+'" type="text/html" '+u.join(" ")+">"+a+"</script>"}),o.snippetsContainerCategories=o.beautifyCategories(o.snippetsContainerCategories),o.snippetsComponentCategories=o.beautifyCategories(o.snippetsComponentCategories),a.find("#keditor-snippets-list").html('<ul id="keditor-snippets-type-switcher" class="keditor-ui keditor-tabs">    <li class="keditor-ui keditor-tab active"><a class="keditor-ui" href="#keditor-container-snippets-tab"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabContainersTitle+'">'+i.tabContainersText+'</a></li>    <li class="keditor-ui keditor-tab"><a class="keditor-ui" href="#keditor-component-snippets-tab"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom"':"")+' title="'+i.tabComponentsTitle+'">'+i.tabComponentsText+'</a></li></ul><div id="keditor-snippets-container" class="keditor-ui keditor-tabs-content">   <div class="keditor-ui keditor-tab-content active" id="keditor-container-snippets-tab"><div class="keditor-ui keditor-tab-content-inner">'+r+'</div></div>   <div class="keditor-ui keditor-tab-content" id="keditor-component-snippets-tab"><div class="keditor-ui keditor-tab-content-inner">'+s+"</div></div></div>").addClass("loaded-snippets"),a.find("#keditor-snippets-content").html(d)},o.prototype.beautifyCategories=function(e){for(var n=[],o=0;o<e.length;o++){var i=e[o]||"";""!==i&&t.inArray(i,n)===-1&&n.push(i)}return n.sort()},o.prototype.getConnectedForContainerSnippets=function(){var t=this,e=t.options,n=t.body,o=".keditor-content-area";return e.nestedContainerEnabled&&(o+=",.keditor-container-content:not(.keditor-sub-container-content)"),n.find(o)},o.prototype.initSnippets=function(){e("initSnippets");var t=this,n=t.options,o=t.body,i=o.find("#keditor-snippets-list"),a=t.containerSnippets=i.find(".keditor-snippet[data-type=container]"),r=t.componentSnippets=i.find(".keditor-snippet[data-type^=component]");e("Initialize $.fn.draggable for container snippets list"),a.draggable({helper:"clone",revert:"invalid",connectToSortable:t.getConnectedForContainerSnippets(),start:function(){o.find("[contenteditable]").blur(),o.find(".showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),o.addClass("highlighted-container-content"),n.nestedContainerEnabled&&o.find(".keditor-sub-container-content").sortable("disable")},stop:function(){n.nestedContainerEnabled&&a.draggable("option","connectToSortable",t.getConnectedForContainerSnippets()),r.draggable("option","connectToSortable",o.find(".keditor-container-content")),n.nestedContainerEnabled&&o.find(".keditor-sub-container-content").sortable("enable"),o.removeClass("highlighted-container-content")}}),r.draggable({helper:"clone",revert:"invalid",connectToSortable:o.find(".keditor-container-content"),start:function(){o.find("[contenteditable]").blur(),o.find(".showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),o.addClass("highlighted-container-content")},stop:function(){o.removeClass("highlighted-container-content")}})},o.prototype.initTabs=function(){e("initTabs");var n=this,o=n.body,i=n.options,a=o.find("#keditor-snippets-type-switcher"),r=o.find("#keditor-snippets-container");if(i.extraTabs&&t.isPlainObject(i.extraTabs)){e("Add extra tabs",i.extraTabs);for(var s in i.extraTabs){var d=i.extraTabs[s];a.append('<li class="keditor-ui keditor-tab"><a class="keditor-ui" href="#keditor-extra-tab-'+s+'"'+(i.tabTooltipEnabled?'data-toggle="tooltip" data-placement="bottom" title="'+d.title+'"':"")+">"+d.text+"</a></li>"),r.append('<div class="keditor-ui keditor-tab-content" id="keditor-extra-tab-'+s+'"><div class="keditor-tab-content-inner">'+d.content+"</div></div>")}}n.initNiceScroll(r.find(".keditor-tab-content-inner"))},o.prototype.initTabsSwitcher=function(){e("initTabsSwitcher");var n=this,o=n.body,i=o.find("#keditor-snippets-type-switcher li"),a=o.find("#keditor-snippets-container .keditor-tab-content");i.find("a").on("click",function(e){e.preventDefault();var r=t(this),s=r.parent(),d=r.attr("href");if(!s.hasClass("active")){var c=i.filter(".active"),l=a.filter(".active"),p=o.find(d);if(c.removeClass("active"),l.removeClass("active"),s.addClass("active"),p.addClass("active"),t.fn.niceScroll&&n.options.niceScrollEnabled){l.getNiceScroll().hide();var f=p.getNiceScroll();f.show(),f.resize()}}})},o.prototype.initSettingPanel=function(){e("initSettingPanel");var o=this,i=o.options,a=o.body;a.find("#keditor-setting-closer").on("click",function(t){t.preventDefault(),o.hideSettingPanel()});var r=a.find("#keditor-setting-forms");if(o.initNiceScroll(r),r.on("submit","form",function(t){return t.preventDefault(),!1}),i.containerSettingEnabled===!0)if("function"==typeof i.containerSettingInitFunction){var s=t('<div id="keditor-container-setting" class="keditor-ui keditor-setting-form clearfix"></div>');r.append(s),e("Initialize container setting panel"),i.containerSettingInitFunction.call(o,s,o)}else n('"containerSettingInitFunction" is not function!')},o.prototype.setSettingContainer=function(t){e("setSettingContainer",t);var n=this,o=n.body;if(t){var i=t.attr("id");o.attr("data-setting-container",i)}else o.removeAttr("data-setting-container")},o.prototype.getSettingContainer=function(){e("getSettingContainer");var t=this,n=t.body,o=n.attr("data-setting-container");return n.find("#"+o)},o.prototype.setSettingComponent=function(t){e("setSettingComponent",t);var n=this,o=n.body;if(t){var i=t.attr("id");o.attr("data-setting-component",i)}else o.removeAttr("data-setting-component")},o.prototype.getSettingComponent=function(){e("getSettingComponent");var t=this,n=t.body,o=n.attr("data-setting-component");return n.find("#"+o)},o.prototype.showSettingPanel=function(n){e("showSettingPanel",n);var i=this,a=i.options,r=i.body,s=n.is(".keditor-component"),d=r.find("#keditor-setting-forms").children(".active");if(d.removeClass("active"),s){i.setSettingComponent(n),i.setSettingContainer(null);var c=i.getComponentType(n),l=o.components[c];r.find("#keditor-setting-title").html(l.settingTitle);var p=r.find("#keditor-setting-forms"),f=r.find("#keditor-setting-"+c);if(0===f.length){var l=o.components[c];if("function"==typeof l.initSettingForm){f=t('<div id="keditor-setting-'+c+'" data-type="'+c+'" class="keditor-ui keditor-setting-form clearfix active"></div>');var C=t("<span />").html("Loading...");p.append(f),f.append(C),e('Initializing setting form for component type "'+c+'"');var u=l.initSettingForm.call(l,f,i);t.when(u).done(function(){e('Initialized setting form for component type "'+c+'"'),setTimeout(function(){C.remove(),"function"==typeof l.showSettingForm?(e('Show setting form of component type "'+c+'"'),l.showSettingForm.call(l,f,n,i)):e('"showSettingForm" function of component type "'+c+'" does not exist')},100)})}else e('"initSettingForm" function of component type "'+c+'" does not exist')}else"function"==typeof l.showSettingForm?(e('Show setting form of component type "'+c+'"'),l.showSettingForm.call(l,f,n,i)):e('"showSettingForm" function of component type "'+c+'" does not exist'),f.addClass("active")}else{i.setSettingContainer(n),i.setSettingComponent(null),r.find("#keditor-setting-title").html("Container Settings");var f=r.find("#keditor-container-setting");"function"==typeof a.containerSettingShowFunction?(e("Show setting form of container"),a.containerSettingShowFunction.call(i,f,n,i)):e('"containerSettingShowFunction" does not exist'),f.addClass("active")}i.toggleSidebar(!0),r.addClass("opened-keditor-setting")},o.prototype.hideSettingPanel=function(){e("hideSettingPanel");var t=this,n=t.options,i=t.body;i.removeClass("opened-keditor-setting");var a=i.find("#keditor-setting-forms").children(".active");if(a.length>0){if(a.is("#keditor-container-setting"))"function"==typeof n.containerSettingHideFunction?(e("Hide setting form of container"),n.containerSettingHideFunction.call(t,a,t)):e('"containerSettingHideFunction" does not exist');else{var r=a.attr("data-type"),s=o.components[r];"function"==typeof s.hideSettingForm?(e('Hide setting form of component type "'+r+'"'),s.hideSettingForm.call(s,a,t)):e('"hideSettingForm" function of component type "'+r+'" does not exist')}a.removeClass("active")}i.removeClass("opened-keditor-setting"),t.setSettingComponent(null),t.setSettingContainer(null)},o.prototype.getContentAreas=function(n){e("getContentAreas",n);var o,i=this,a=i.options;if(a.contentAreasSelector&&(o=n.find(a.contentAreasSelector)),!o||0===o.length){e("Do not find any content area. Creating default content area..."),o=t("<div />");var r=n.html();o.html(r),n.empty().append(o)}return o},o.prototype.initContentAreas=function(n){e("initContentAreas",n);var o=this,i=o.getContentAreas(n);i.each(function(){var e=t(this);e.attr("id")||e.attr("id",o.generateId("content-area")),o.initContentArea(e),e.data("keditor",o)})},o.prototype.initContentArea=function(n){e("initContentArea",n);var o=this,i=o.options,a=o.body;if(n.addClass("keditor-content-area"),"function"==typeof i.onBeforeInitContentArea&&i.onBeforeInitContentArea.call(o,n),e("Initialize $.fn.sortable for content area"),n.sortable({handle:".keditor-toolbar-container:not(.keditor-toolbar-sub-container) .btn-container-reposition",items:"> section",helper:"clone",connectWith:".keditor-content-area",axis:"y",sort:function(){t(this).removeClass("ui-state-default")},receive:function(r,s){e("On received snippet",r,s);var d=s.helper,c=s.item;if(c.is(".keditor-snippet")){var l=a.find(c.attr("data-snippet")).html();e("Snippet content",l);var p=t('<section class="keditor-ui keditor-container">   <section class="keditor-ui keditor-container-inner">'+l+"</section></section>");d.replaceWith(p),p.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),p.addClass("showed-keditor-toolbar")),"function"==typeof i.onContainerSnippetDropped&&i.onContainerSnippetDropped.call(o,r,p,s.item,n),o.initContainer(n,p)}else d&&d.remove();o.hideSettingPanel(),"function"==typeof i.onContentChanged&&i.onContentChanged.call(o,r,n),c.addClass("keditor-ui-dragging"),n.removeClass("keditor-highlighted-dropzone")},start:function(t,e){a.addClass("highlighted-container-content"),e.item.addClass("keditor-ui-dragging")},stop:function(t,e){a.removeClass("highlighted-container-content"),n.removeClass("keditor-highlighted-dropzone"),e.helper&&e.helper.remove(),e.item.removeClass("keditor-ui-dragging")},over:function(){n.addClass("keditor-highlighted-dropzone")},out:function(){n.addClass("keditor-highlighted-dropzone")}}),e("Initialize existing containers in content area"),n.children("section").each(function(){o.convertToContainer(n,t(this))}),"function"==typeof i.onInitContentArea){var r=i.onInitContentArea.call(o,n);r&&r.length>0&&t.each(r,function(){o.convertToContainer(n,t(this))})}},o.prototype.convertToContainer=function(t,n){e("convertToContainer",t,n);var o,i=this,a=n.is("section");a?(n.addClass("keditor-container"),n.wrapInner('<section class="keditor-ui keditor-container-inner"></section>'),o=n):(n.wrap('<section class="keditor-ui keditor-container"><section class="keditor-ui keditor-container-inner"></section></section>'),o=n.parent().parent()),i.initContainer(t,o)},o.prototype.initContainer=function(n,o){var i=this,a=i.options,r=a.nestedContainerEnabled&&o.closest('[data-type="container-content"]').length>0;if(e("initContainer - isNested="+r,n,o),o.hasClass("keditor-initialized-container")&&o.hasClass("keditor-initializing-container"))e(o.hasClass("keditor-initialized-container")?"Container is already initialized!":"Container is initializing...");else{o.addClass("keditor-initializing-container"),"function"==typeof a.onBeforeInitContainer&&a.onBeforeInitContainer.call(i,o,n),r&&o.addClass("keditor-sub-container");var s="";a.containerSettingEnabled===!0&&(s='<a href="javascript:void(0);" class="keditor-ui btn-container-setting">'+a.btnSettingContainerText+"</a>"),e("Render KEditor toolbar for container",o),o.append('<div class="keditor-toolbar keditor-toolbar-container '+(r?"keditor-toolbar-sub-container":"")+'">   <a href="javascript:void(0);" class="keditor-ui btn-container-reposition">'+a.btnMoveContainerText+"</a>"+s+'   <a href="javascript:void(0);" class="keditor-ui btn-container-duplicate">'+a.btnDuplicateContainerText+'</a>   <a href="javascript:void(0);" class="keditor-ui btn-container-delete">'+a.btnDeleteContainerText+"</a></div>"),o.attr("id",i.generateId(r?"sub-container":"container"));var d=o.find('[data-type="container-content"]');e("Initialize "+d.length+" container content(s)"),d.each(function(){var e=t(this);a.nestedContainerEnabled?r?i.initContainerContent(n,o,e,r):0===e.parents('[data-type="container-content"]').length&&i.initContainerContent(n,o,e,r):i.initContainerContent(n,o,e,r)}),"function"==typeof a.onInitContainer&&a.onInitContainer.call(i,o,n),o.addClass("keditor-initialized-container"),o.removeClass("keditor-initializing-container")}},o.prototype.initContainerContent=function(n,o,i,a){e("initContainerContent - isNested="+a,n,o,i);var r=this,s=r.options,d=r.body;i.addClass("keditor-container-content"),a&&i.addClass("keditor-sub-container-content"),i.attr("id",r.generateId("container-content")),e("Initialize $.fn.sortable for container content"),i.sortable({handle:".btn-component-reposition, .btn-container-reposition",helper:"clone",items:"> section",connectWith:".keditor-container-content",sort:function(){t(this).removeClass("ui-state-default")},receive:function(o,a){e("On received snippet",o,a);var c,l=a.helper,p=a.item;if(p.is(".keditor-snippet")){var f=d.find(p.attr("data-snippet")),C=f.html(),u=p.attr("data-type");if(e("Snippet content",C),"container"===u){e("Add nested container into container content",i);var c=t('<section class="keditor-ui keditor-container">   <section class="keditor-ui keditor-container-inner">'+C+"</section></section>");l.replaceWith(c),c.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),c.addClass("showed-keditor-toolbar")),"function"==typeof s.onContainerSnippetDropped&&s.onContainerSnippetDropped.call(r,o,c,a.item,n),r.initContainer(n,c)}else{e("Add component into container content",i);var g=r.getDataAttributes(f,null,!0),m=t('<section class="keditor-ui keditor-component" data-type="'+u+'" '+g.join(" ")+'>   <section class="keditor-ui keditor-component-content">'+C+"</section></section>");l.replaceWith(m),c=m.closest(".keditor-container"),"function"==typeof s.onComponentSnippetDropped&&s.onComponentSnippetDropped.call(r,o,m,a.item,n),r.initComponent(n,c,m)}}else l&&l.remove(),c=p.closest(".keditor-container");c.hasClass("showed-keditor-toolbar")||(t(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),c.addClass("showed-keditor-toolbar")),"function"==typeof s.onContainerChanged&&s.onContainerChanged.call(r,o,c,n),"function"==typeof s.onContentChanged&&s.onContentChanged.call(r,o,n),p.removeClass("keditor-ui-dragging"),n.removeClass("keditor-highlighted-dropzone")},start:function(t,e){d.addClass("highlighted-container-content"),e.item.addClass("keditor-ui-dragging")},stop:function(t,e){d.removeClass("highlighted-container-content"),i.removeClass("keditor-highlighted-dropzone"),e.helper&&e.helper.remove(),e.item.removeClass("keditor-ui-dragging")},over:function(){i.addClass("keditor-highlighted-dropzone")},out:function(){i.removeClass("keditor-highlighted-dropzone")}}),e("Initialize existing components inside container content"),i.children().each(function(){var e=t(this);e.find('[data-type="container-content"]').length>0?r.convertToContainer(n,e):r.convertToComponent(n,o,e,!0)})},o.prototype.convertToComponent=function(t,n,o,i){e("convertToComponent",t,n,o,i);var a,r=this,s=o.is("section");s?(o.addClass("keditor-component"),o.wrapInner('<section class="keditor-ui keditor-component-content"></section>'),a=o):(o.wrap('<section class="keditor-ui keditor-component"><section class="keditor-ui keditor-component-content"></section></section>'),a=o.parent().parent()),i&&a.addClass("existing-component"),r.initComponent(t,n,a)},o.prototype.getDataAttributes=function(e,n,o){var i=o?[]:{};return n||(n=[]),t.each(e.get(0).attributes,function(e,a){0===a.name.indexOf("data-")&&t.inArray(a.name,n)===-1&&(o?i.push(a.name+'="'+a.value+'"'):i[a.name]=a.value)}),i},o.prototype.getComponentType=function(t){e("getComponentType",t);var i=this,a=i.options,r=t.attr("data-type"),s=r?r.replace("component-",""):"";return s&&s in o.components?s:(e(s?'Component type "'+s+'" does not exist':"This component does not contain data-type attribute"),"string"==typeof a.defaultComponentType?s=a.defaultComponentType:"function"==typeof a.defaultComponentType&&(s=a.defaultComponentType.call(i,t)),s||n("Component type is undefined!"),e("Fallback to defaultComponentType: "+s),s)},o.prototype.initComponent=function(n,i,a){e("initComponent",n,i,a);var r=this,s=r.options,d=r.body;if(a.hasClass("keditor-initialized-component")&&a.hasClass("keditor-initializing-component"))e(a.hasClass("keditor-initialized-component")?"Component is already initialized!":"Component is initializing...");else{a.addClass("keditor-initializing-component"),a.attr("id",r.generateId("component")),"function"==typeof s.onBeforeInitComponent&&s.onBeforeInitComponent.call(r,a,n);var c=a.children(".keditor-component-content");c.attr("id",r.generateId("component-content"));var l=r.getComponentType(a);e("Component type: "+l);var p=o.components[l],f=p.settingEnabled,C="";f&&(C='<a href="javascript:void(0);" class="keditor-ui btn-component-setting">'+s.btnSettingComponentText+"</a>"),e("Render KEditor toolbar for component",a),a.append('<div class="keditor-toolbar keditor-toolbar-component">   <a href="javascript:void(0);" class="keditor-ui btn-component-reposition">'+s.btnMoveComponentText+"</a>"+C+'   <a href="javascript:void(0);" class="keditor-ui btn-component-duplicate">'+s.btnDuplicateComponentText+'</a>   <a href="javascript:void(0);" class="keditor-ui btn-component-delete">'+s.btnDeleteComponentText+"</a></div>"),a.find("[data-dynamic-href]").each(function(){var e=t(this);r.initDynamicContent(e)}),"function"==typeof p.init?p.init.call(p,n,i,a,r):(d.removeClass("highlighted-container-content"),e('"init" function of component type "'+l+'" does not exist')),"function"==typeof s.onInitComponent&&s.onInitComponent.call(r,a,n),a.addClass("keditor-initialized-component"),a.removeClass("keditor-initializing-component")}},o.prototype.getClickedElement=function(e,n){var o=t(e.target),i=o.closest(n);return o.is(n)?o:i.length>0?i:null},o.prototype.initKEditorClicks=function(){e("initKEditorClicks");var n=this,o=n.options,i=n.body;i.on("click",function(t){var e=n.getClickedElement(t,"#keditor-sidebar"),a=n.getClickedElement(t,".keditor-container");if(a){if(!a.hasClass("showed-keditor-toolbar")){i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),a.addClass("showed-keditor-toolbar");var r=a.parent();"function"==typeof o.onContainerSelected&&o.onContainerSelected.call(n,t,a,r)}}else e||(i.find(".keditor-container.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"));var s=n.getClickedElement(t,".keditor-component");if(s){if(!s.hasClass("showed-keditor-toolbar")){i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar"),s.addClass("showed-keditor-toolbar");var r=s.parent();"function"==typeof o.onComponentSelected&&o.onComponentSelected.call(n,t,s,r)}}else e||i.find(".keditor-component.showed-keditor-toolbar").removeClass("showed-keditor-toolbar")}),i.on("click",".btn-container-setting",function(o){o.preventDefault();var a=t(this);e("Click on .btn-container-setting",a);var r=a.closest(".keditor-container");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(n.getSettingContainer())?n.hideSettingPanel():n.showSettingPanel(r)}),i.on("click",".btn-container-duplicate",function(a){a.preventDefault();var r=t(this);e("Click on .btn-container-duplicate",r);var s=r.closest(".keditor-container"),d=s.parent(),c=t(n.getContainerContent(s,r.parent().hasClass("keditor-toolbar-sub-container")));s.after(c),n.convertToContainer(d,c);var l=i.find("#keditor-snippets-list"),p=l.find(".keditor-snippet[data-type^=component]"),f=p.draggable("option","connectToSortable");p.draggable("option","connectToSortable",f.add(c.find(".keditor-container-content"))),e("Container is duplicated"),"function"==typeof o.onContainerDuplicated&&o.onContainerDuplicated.call(n,s,c,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(n,a,d)}),i.on("click",".btn-container-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-container-delete",a),confirm(o.confirmDeleteContainerText)){var r=a.closest(".keditor-container"),s=r.find(".keditor-component"),d=r.parent();
"function"==typeof o.onBeforeContainerDeleted&&o.onBeforeContainerDeleted.call(n,i,r,d);var c=n.getSettingComponent();if(c&&c.length>0){var l=c.closest(".keditor-container");l.is(r)&&(e("Deleting container is container of setting container. Close setting panel for this setting component",c),n.hideSettingPanel())}else n.getSettingContainer().is(r)&&(e("Deleting container is setting container. Close setting panel for this container",r),n.hideSettingPanel());s.length>0&&s.each(function(){n.deleteComponent(t(this))}),r.remove(),"function"==typeof o.onContainerDeleted&&o.onContainerDeleted.call(n,i,r,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(n,i,d)}}),i.on("click",".btn-component-setting",function(o){o.preventDefault();var a=t(this);e("Click on .btn-component-setting",a);var r=a.closest(".keditor-component");i.hasClass("opened-keditor-setting")&&i.hasClass("opened-keditor-sidebar")&&r.is(n.getSettingComponent())?n.hideSettingPanel():n.showSettingPanel(r)}),i.on("click",".btn-component-duplicate",function(i){i.preventDefault();var a=t(this);e("Click on .btn-component-duplicate",a);var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=s.parent(),c=t(n.getComponentContent(r));r.after(c),n.convertToComponent(d,s,c),e("Component is duplicated"),"function"==typeof o.onComponentDuplicated&&o.onComponentDuplicated.call(n,r,c,d),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(n,i,s,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(n,i,d)}),i.on("click",".btn-component-delete",function(i){i.preventDefault();var a=t(this);if(e("Click on .btn-component-delete",a),confirm(o.confirmDeleteComponentText)){var r=a.closest(".keditor-component"),s=r.closest(".keditor-container"),d=r.closest(".keditor-content-area");"function"==typeof o.onBeforeComponentDeleted&&o.onBeforeComponentDeleted.call(n,i,r,d),n.getSettingComponent().is(r)&&n.hideSettingPanel(),n.deleteComponent(r),"function"==typeof o.onComponentDeleted&&o.onComponentDeleted.call(n,i,r,d),"function"==typeof o.onContainerChanged&&o.onContainerChanged.call(n,i,s,d),"function"==typeof o.onContentChanged&&o.onContentChanged.call(n,i,d)}})},o.prototype.deleteComponent=function(t){e("deleteComponent",t);var n=this,i=n.getComponentType(t),a=o.components[i];"function"==typeof a.destroy?a.destroy.call(a,t,n):e('"destroy" function of component type "'+i+'" does not exist'),t.remove()},o.prototype.initDynamicContent=function(n){e("initDynamicContent",n);var o=this,i=o.options,a=n.closest(".keditor-component"),r=n.closest(".keditor-content-area");n.attr("id",o.generateId("dynamic-element")),"function"==typeof i.onBeforeDynamicContentLoad&&i.onBeforeDynamicContentLoad.call(o,n,a,r);var s=n.attr("data-dynamic-href"),d=o.getDataAttributes(a,["data-type","data-dynamic-href"],!1);return d=t.param(d),e("Dynamic href: "+s,"Data: "+d),t.ajax({url:s,data:d,type:"GET",dataType:"HTML",success:function(t,a,s){e("Dynamic content is loaded",n,t,a,s),n.html(t),"function"==typeof i.onDynamicContentLoaded&&i.onDynamicContentLoaded.call(o,n,t,a,s,r)},error:function(t,a,s){e("Error when loading dynamic content",n,t,a,s),"function"==typeof i.onDynamicContentError&&i.onDynamicContentError.call(o,n,t,a,s,r)}})},o.prototype.getComponentContent=function(n){e("getComponentContent",n);var i=this;n=n.clone();var a,r=i.getComponentType(n),s=o.components[r],d=i.getDataAttributes(n,null,!0),c=n.find(".keditor-iframe-wrapper");if(c.length>0){c.find(".keditor-iframe-cover").remove();var l=c.children("iframe");c.hasClass("keditor-iframe-wrapper-fake")?l.unwrap():c.removeClass("keditor-iframe-wrapper")}if("function"==typeof s.getContent)a=s.getContent.call(s,n,i);else{e('"getContent" function of component type "'+r+'" does not exist. Using default getContent method');var p=n.children(".keditor-component-content");a=p.html()}var f=t("<div />").html(a);return f.find("[data-dynamic-href]").each(function(){t(this).html("")}),a=f.html(),"<section "+d.join(" ")+">"+a+"</section>"},o.prototype.getContainerContent=function(n,o){e("getContainerContent - isNested="+o,n);var i=this,a=n.children(".keditor-container-inner").clone();return a.find("[data-type=container-content]").not(o?"":".keditor-sub-container-content").each(function(){var e=t(this);e.removeClass("keditor-container-content keditor-sub-container-content ui-droppable ui-sortable").removeAttr("id"),e.children().each(function(){var e=t(this);e.is(".keditor-component")?e.replaceWith(i.getComponentContent(e)):e.is(".keditor-sub-container")&&e.replaceWith(i.getContainerContent(e,!0))})}),"<section>"+a.html()+"</section>"},o.prototype.getContent=function(e){var n=this,o=n.options,i=[],a=o.iframeMode?n.body:n.element;return a.is("textarea")&&(a=t(a.attr("data-keditor-wrapper"))),a.find(".keditor-content-area").each(function(){var e="";t(this).children(".keditor-container").each(function(){var o=t(this);e+=n.getContainerContent(o)}),i.push(e)}),e?i:i.join("\n")},o.prototype.initIframeCover=function(e,n){n||(e.wrap('<div class="keditor-iframe-wrapper-fake"></div>'),n=e.parent()),n.addClass("keditor-iframe-wrapper");var o=t('<div class="keditor-iframe-cover"></div>');n.prepend(o),n.on("mouseleave",function(){n.removeClass("hidden-cover")}),o.on("dblclick",function(t){t.preventDefault(),n.addClass("hidden-cover")})},o.prototype.setContent=function(e,o){var i=this,a=i.options,r=i.body,s=a.iframeMode?i.contentAreasWrapper:i.element;s.is("textarea")&&(s=t(s.attr("data-keditor-wrapper"))),o?o.jquery||(o=s.find(o)):o=s.children(),0===o.length&&n("Content area does not exist!"),o.html(e),i.initContentArea(o),a.nestedContainerEnabled&&i.containerSnippets.draggable("option","connectToSortable",i.getConnectedForContainerSnippets()),i.componentSnippets.draggable("option","connectToSortable",r.find(".keditor-container-content"))},o.prototype.getOptions=function(){return t.extend(!0,{},this.options)},o.prototype.destroy=function(e){var n=this.element,i=n.attr("data-keditor-instance");if(e){var a=this.getContent(!1);n.is("textarea")?n.val(a):n.html(a)}if(this.options.iframeMode)t(n.attr("data-keditor-frame")).remove(),n.removeAttr("data-keditor-frame");else{n.is("textarea")&&(t(n.attr("data-keditor-wrapper")).remove(),n.removeAttr("data-keditor-wrapper"));var r=0;for(var i in o.instances)o.instances[i].options.iframeMode||r++;0===r&&(this.body.removeClass("initialized-snippets-list opened-keditor-sidebar"),this.body.find("#keditor-sidebar").remove())}n.removeAttr("data-keditor-instance"),n.removeClass("keditor-hidden-element"),n.data("keditor",null),delete o.instances[i]},t.fn.keditor=function(e){var n=t(this),i=n.data("keditor");if("string"!=typeof e){if(!i){i=new o(n,e),n.data("keditor",i);var a=i.generateId("instance");n.attr("data-keditor-instance",a),o.instances[a]=i}return i}if(i&&i[e]&&"function"==typeof i[e])return i[e].apply(i,Array.prototype.slice.call(arguments,1))},t.fn.keditor.constructor=o,t.keditor=o}(jQuery);
//# sourceMappingURL=keditor.min.js.map
